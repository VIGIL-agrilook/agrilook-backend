# 🌾 농업 AI 챗봇 - 개선된 버전 실행 가이드

## 📋 개선사항 요약

### ✨ GPT 권장사항 반영
1. **텍스트 품질 검사**: 한글 비율 30% 이상만 사용
2. **레이아웃 보존 추출**: 좌표 기반 정렬로 문단 순서 유지
3. **노이즈 정리**: 과도한 공백, 소수점, 기호 반복 제거
4. **최적화된 청크**: 1000자 청크, 150자 오버랩
5. **하이브리드 검색**: 벡터(70%) + BM25(30%) + 중복제거
6. **한글 토크나이저**: BM25에 한국어 최적화 적용
7. **메타데이터 강화**: 출처 추적 및 가독성 개선
8. **프롬프트 안전장치**: 수치 날조 방지

## 🚀 실행 순서

### 1단계: OCR 전처리 (선택사항)
```bash
# OCRmyPDF 설치 (처음 한 번만)
pip install ocrmypdf

# PDF 전처리 실행
python src/pdf_preprocessor.py
```

### 2단계: 개선된 임베딩 생성
```bash
# 기존 벡터스토어 삭제
Remove-Item "src/vectorstore/*" -Force

# 개선된 임베더 실행
python src/embedder_improved.py
```

### 3단계: 개선된 챗봇 실행
```bash
python src/chatbot_improved.py
```

## 📊 기대 효과

### 🔍 검색 품질 개선
- **품질 필터링**: 깨진 텍스트 제거로 노이즈 감소
- **하이브리드 검색**: 의미 검색 + 키워드 검색 결합
- **중복 제거**: 같은 정보 반복 방지

### 📚 답변 품질 개선
- **출처 명시**: `[주간농사정보 30호, p.2]` 형식
- **수치 검증**: 근거 없는 숫자 생성 방지
- **구체적 조언**: 실용적인 농업 정보 제공

### 🎯 한국어 최적화
- **토크나이저**: 한글 단위 분석
- **품질 검사**: 한글 비율 기반 필터링
- **농업 용어**: 전문 용어 인식 개선

## 🔧 파라미터 튜닝 가이드

### 청크 크기 조정
```python
# embedder_improved.py에서
chunk_size=1000,    # 800-1200 권장
chunk_overlap=150,  # 100-150 권장
```

### 검색 가중치 조정
```python
# chatbot_improved.py에서
weights=[0.7, 0.3]  # [벡터, BM25] 비율
```

### 품질 임계값 조정
```python
# 한글 비율 조정
if ratio > 0.3:  # 0.2-0.4 사이 권장
```

## 🐛 문제 해결

### OCRmyPDF 설치 오류
```bash
# Windows에서 Tesseract 설치 필요
# https://github.com/UB-Mannheim/tesseract/wiki

# 경로 확인
where tesseract
```

### 메모리 부족
```python
# 배치 크기 줄이기
for i in range(0, len(all_chunks), 25):  # 50 → 25
```

### 검색 성능 저하
```python
# 문서 수 줄이기
top_quality_docs = quality_docs[:100]  # 200 → 100
```

## 📈 성능 모니터링

### 실행 중 확인사항
1. **품질 문서 비율**: 전체 문서의 70% 이상
2. **청크 생성**: PDF당 50-200개 권장
3. **검색 응답시간**: 3초 이내 권장

### 품질 평가 방법
1. **답변 길이**: 300-800자 적정
2. **출처 개수**: 3-8개 권장
3. **한글 품질**: 문장 완결성 확인

## 🔄 지속적 개선

### A/B 테스트 아이디어
- 가중치 비율: [0.8, 0.2] vs [0.6, 0.4]
- 청크 크기: 800자 vs 1200자
- 품질 임계값: 0.3 vs 0.4

### 추가 개선 방향
1. **Reranker 추가**: 상위 3-5개만 선별
2. **Parent Document**: 더 큰 맥락 제공  
3. **Cross-Encoder**: 관련성 점수 개선
4. **동적 청크**: 문서 구조 기반 분할

## 💡 팁

1. **PDF 품질이 중요**: 가능하면 OCR 전처리 권장
2. **정기적 재임베딩**: 새 문서 추가시
3. **프롬프트 튜닝**: 도메인별 맞춤 설정
4. **로그 분석**: 자주 묻는 질문 패턴 파악
